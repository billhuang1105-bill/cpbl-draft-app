<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>CPBL Draft Room</title>
    <style>
        body { font-family: sans-serif; margin: 20px; }
        h2 { margin-top: 40px; }
        .position-group { margin-bottom: 20px; }
        button { margin: 2px; }
    </style>
</head>
<body>
    <h1>CPBL Draft Room</h1>

    <div id="input-phase">
        <h2>1. 輸入球員名單</h2>
        <div class="position-group">
            <strong>投手 (P):</strong><br>
            <input id="P" placeholder="用逗號分隔，如 王小明,張大偉" size="50">
        </div>
        <div class="position-group">
            <strong>捕手 (C):</strong><br>
            <input id="C" placeholder="用逗號分隔，如 陳俊男,李國豪" size="50">
        </div>
        <div class="position-group">
            <strong>內野手 (IF):</strong><br>
            <input id="IF" placeholder="用逗號分隔，如 林志強,周思齊" size="50">
        </div>
        <div class="position-group">
            <strong>外野手 (OF):</strong><br>
            <input id="OF" placeholder="用逗號分隔，如 張志豪,詹子賢" size="50">
        </div>
        <button onclick="submitPlayers()">送出名單</button>
        <button onclick="startDraft()">開始選秀</button>
    </div>

    <div id="draft-phase" style="display:none;">
        <h2>2. 選秀進行中</h2>
        <p>目前輪到隊伍：<span id="turn"></span></p>
        <div id="positions"></div>
    </div>

    <h2>球隊名單</h2>
    <p><strong>A 隊:</strong> <span id="teamA"></span></p>
    <p><strong>B 隊:</strong> <span id="teamB"></span></p>

    <button onclick="reset()">重新開始</button>

    <script>
        let ws = new WebSocket(`wss://${location.host}/ws`);
        let myTeam = prompt("請輸入你的隊名（A 或 B）：", "A").toUpperCase();

        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === "state") {
                document.getElementById("teamA").textContent = data.teams.A.join(", ");
                document.getElementById("teamB").textContent = data.teams.B.join(", ");
                document.getElementById("turn").textContent = data.turn;

                if (data.started) {
                    document.getElementById("input-phase").style.display = "none";
                    document.getElementById("draft-phase").style.display = "block";
                }

                const container = document.getElementById("positions");
                container.innerHTML = "";

                for (const pos in data.available) {
                    if (data.available[pos].length > 0) {
                        const div = document.createElement("div");
                        div.innerHTML = `<strong>${pos}:</strong>`;
                        data.available[pos].forEach(player => {
                            const btn = document.createElement("button");
                            btn.textContent = player;
                            btn.onclick = () => {
                                if (data.turn === myTeam && confirm(`確定選擇 ${player} 嗎？`)) {
                                    ws.send(JSON.stringify({ type: "pick", position: pos, player: player, team: myTeam }));
                                }
                            };
                            div.appendChild(btn);
                        });
                        container.appendChild(div);
                    }
                }

                if (data.finished) {
                    container.innerHTML = "<h3>選秀結束！</h3>";
                }
            }
        };

        function submitPlayers() {
            const players = {
                P: document.getElementById("P").value.split(",").map(s => s.trim()).filter(Boolean),
                C: document.getElementById("C").value.split(",").map(s => s.trim()).filter(Boolean),
                IF: document.getElementById("IF").value.split(",").map(s => s.trim()).filter(Boolean),
                OF: document.getElementById("OF").value.split(",").map(s => s.trim()).filter(Boolean),
            };
            ws.send(JSON.stringify({ type: "add_players", players }));
        }

        function startDraft() {
            ws.send(JSON.stringify({ type: "start_draft" }));
        }

        function reset() {
            ws.send(JSON.stringify({ type: "reset" }));
        }
    </script>
</body>
</html>
