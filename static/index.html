<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>中職選秀模擬器</title>
    <style>
        body { font-family: sans-serif; background: #f6f6f6; margin: 20px; }
        h2 { margin-top: 30px; }
        input, button, select { margin: 5px; }
        .team-box { width: 45%; display: inline-block; vertical-align: top; background: #fff; padding: 10px; margin: 10px; border-radius: 8px; box-shadow: 0 0 5px #ccc; }
        .player-button { margin: 3px; padding: 4px 8px; }
        .highlight { font-weight: bold; color: red; }
    </style>
</head>
<body>
    <h1>中職選秀模擬器</h1>

    <h2>1. 輸入球員名單（選秀前）</h2>
    <div>
        <label>P：</label><input id="P" placeholder="以逗號分隔"><br>
        <label>C：</label><input id="C" placeholder="以逗號分隔"><br>
        <label>IF：</label><input id="IF" placeholder="以逗號分隔"><br>
        <label>OF：</label><input id="OF" placeholder="以逗號分隔"><br>
        <button onclick="submitPlayers()">送出名單</button>
        <button onclick="startDraft()">開始選秀</button>
        <button onclick="resetDraft()">重置</button>
    </div>

    <h2>2. 開始選秀</h2>
    <p>目前輪到：<span id="turn">-</span></p>
    <div>
        選擇守備位置：
        <button onclick="setPosition('P')">P</button>
        <button onclick="setPosition('C')">C</button>
        <button onclick="setPosition('IF')">IF</button>
        <button onclick="setPosition('OF')">OF</button>
    </div>
    <div id="player-buttons"></div>

    <h3>球隊 A</h3>
    <div class="team-box" id="teamA"></div>

    <h3>球隊 B</h3>
    <div class="team-box" id="teamB"></div>

    <script>
        const ws = new WebSocket(`wss://${location.host}/ws`);
        let selectedPosition = null;
        let currentTurn = "A";
        let draftStarted = false;

        function submitPlayers() {
            const players = {
                P: document.getElementById("P").value.split(",").map(s => s.trim()).filter(Boolean),
                C: document.getElementById("C").value.split(",").map(s => s.trim()).filter(Boolean),
                IF: document.getElementById("IF").value.split(",").map(s => s.trim()).filter(Boolean),
                OF: document.getElementById("OF").value.split(",").map(s => s.trim()).filter(Boolean),
            };
            ws.send(JSON.stringify({ type: "add_players", players }));
        }

        function startDraft() {
            ws.send(JSON.stringify({ type: "start_draft" }));
        }

        function resetDraft() {
            ws.send(JSON.stringify({ type: "reset" }));
        }

        function setPosition(pos) {
            selectedPosition = pos;
            renderPlayers();
        }

        function pickPlayer(name) {
            if (!draftStarted) return;
            if (!selectedPosition) return alert("請先選擇守備位置！");
            if (confirm(`確定選擇 ${name} 嗎？`)) {
                ws.send(JSON.stringify({ type: "pick", team: currentTurn, position: selectedPosition, player: name }));
            }
        }

        function renderPlayers() {
            const div = document.getElementById("player-buttons");
            div.innerHTML = "";
            if (!selectedPosition || !window.available) return;
            window.available[selectedPosition].forEach(name => {
                const btn = document.createElement("button");
                btn.className = "player-button";
                btn.innerText = name;
                btn.onclick = () => pickPlayer(name);
                div.appendChild(btn);
            });
        }

        function renderTeams(teams) {
            document.getElementById("teamA").innerText = teams.A.join(", ");
            document.getElementById("teamB").innerText = teams.B.join(", ");
        }

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === "state") {
                window.available = data.available;
                draftStarted = data.started;
                currentTurn = data.turn;
                document.getElementById("turn").innerText = draftStarted ? currentTurn : "-";
                renderPlayers();
                renderTeams(data.teams);
            }
        };
    </script>
</body>
</html>
