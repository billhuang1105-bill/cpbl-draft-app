<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>中職選秀模擬器</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        h2 { color: #333; }
        .team-box { border: 1px solid #ccc; padding: 10px; margin: 10px; min-height: 80px; background: #fff; }
        .position-box button { margin: 5px; }
        .disabled { opacity: 0.5; pointer-events: none; }
        .turn { font-weight: bold; color: green; }
    </style>
</head>
<body>
    <h2>1. 輸入球員名單（選秀前）</h2>
    <div>
        P：<input type="text" id="pInput" placeholder="用逗號分隔，例如：王小明,張大志"><br>
        C：<input type="text" id="cInput"><br>
        IF：<input type="text" id="ifInput"><br>
        OF：<input type="text" id="ofInput"><br>
        <button onclick="submitPlayers()">送出名單</button>
        <button onclick="startDraft()">開始選秀</button>
        <button onclick="reset()">重置</button>
    </div>

    <h2>2. 開始選秀</h2>
    <div>目前輪到：<span id="turn" class="turn">-</span></div>
    <div class="position-box">
        <span>選擇守備位置：</span>
        <button onclick="showPlayers('P')">P</button>
        <button onclick="showPlayers('C')">C</button>
        <button onclick="showPlayers('IF')">IF</button>
        <button onclick="showPlayers('OF')">OF</button>
    </div>
    <div id="playerOptions"></div>

    <h3>球隊 A</h3>
    <div class="team-box" id="teamA"></div>
    <h3>球隊 B</h3>
    <div class="team-box" id="teamB"></div>

    <script>
        const ws = new WebSocket("wss://" + location.host + "/ws");

        let currentPosition = "";

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            if (data.type === "state") {
                document.getElementById("turn").innerText = data.turn;
                document.getElementById("teamA").innerText = data.teams.A.join(", ");
                document.getElementById("teamB").innerText = data.teams.B.join(", ");
                window.currentState = data;
                if (currentPosition) showPlayers(currentPosition);
            }
        };

        function submitPlayers() {
            const p = document.getElementById("pInput").value.split(",").map(x => x.trim()).filter(x => x);
            const c = document.getElementById("cInput").value.split(",").map(x => x.trim()).filter(x => x);
            const i = document.getElementById("ifInput").value.split(",").map(x => x.trim()).filter(x => x);
            const o = document.getElementById("ofInput").value.split(",").map(x => x.trim()).filter(x => x);
            ws.send(JSON.stringify({ type: "add_players", players: { P: p, C: c, IF: i, OF: o } }));
        }

        function startDraft() {
            ws.send(JSON.stringify({ type: "start_draft" }));
        }

        function reset() {
            ws.send(JSON.stringify({ type: "reset" }));
        }

        function showPlayers(position) {
            currentPosition = position;
            const players = (window.currentState?.available?.[position]) || [];
            const container = document.getElementById("playerOptions");
            container.innerHTML = `<h4>${position} 可選球員</h4>`;
            players.forEach(p => {
                const btn = document.createElement("button");
                btn.textContent = p;
                btn.onclick = () => {
                    const confirmPick = confirm(`確定選擇球員 ${p} 嗎？`);
                    if (confirmPick) {
                        const team = window.currentState.turn;
                        ws.send(JSON.stringify({ type: "pick", team: team, position: position, player: p }));
                    }
                };
                container.appendChild(btn);
            });
        }
    </script>
</body>
</html>
